@page "/memorization-level-three/{CardCollectionId:guid}"

<PageTitle>EasyEnglish | @cardCollection?.Title | Уровень 3</PageTitle>

@if (cardCollection is not null && currentCard is not null)
{
    <MudText Typo="Typo.h5" Align="Align.Center" Class="mb-1">
        @cardCollection.Title
    </MudText>
    <MudText Typo="Typo.h6" Align="Align.Center" Class="mb-5">
        @(currentCardIndex + 1) / @cards.Count
    </MudText>

    <CardLevelThreePaper @ref="cardLevelThreePaper"
                         Card="currentCard"
                         OnGivenAnswer="SetGivenAnswer"
                         OnWrongAnswer="@(() => AddWrongCard(cards[currentCardIndex]))" />

    <MudStack Row AlignItems="AlignItems.Center">
        <MudSpacer />
        @if (currentCardIndex < cards.Count - 1 && givenAnswer)
        {
            <MudIconButton OnClick="NextCard"
                           Icon="@Icons.Material.Filled.ArrowForwardIos" />
        }
    </MudStack>
    
    if (currentCardIndex == cards.Count - 1 && givenAnswer)
    {
        if (wrongAnswerCards.Count > 0)
        {
            <MudStack Row AlignItems="AlignItems.Center" Spacing="2">
                <MudText Typo="Typo.h6">
                    Неправильные ответы
                </MudText>
                <MudIconButton Icon="@(isShowWrongCards ? Icons.Material.Outlined.ArrowDropUp : Icons.Material.Outlined.ArrowDropDown)"
                               OnClick="ToggleShowWrongCards" />
            </MudStack>

            if (isShowWrongCards)
            {
                foreach (var wrongAnswerCard in wrongAnswerCards)
                {
                    <CardPaper Card="wrongAnswerCard" ReadOnly />
                }
            }
        }
        else
        {
            <MudStack AlignItems="AlignItems.Center" Justify="Justify.Center">
                <MudText Typo="Typo.h6" Color="Color.Success">
                    Все ответы верные!
                </MudText>
            </MudStack>
        }
    }
}