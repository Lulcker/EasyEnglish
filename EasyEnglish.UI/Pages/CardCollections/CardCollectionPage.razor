@page "/card-collection/{CardCollectionId:guid}"

<PageTitle>EasyEnglish | @cardCollection?.Title</PageTitle>

<MudStack Row AlignItems="AlignItems.Center" Spacing="2" Class="mb-4">
    <MudText Typo="Typo.h5">
        @cardCollection?.Title @(cards.Count > 0 ? $"[{cards.Count}]" : string.Empty)
    </MudText>
    @if (cardCollection?.IsLearned == true)
    {
        <MudIcon Icon="@Icons.Material.Filled.Check" Color="Color.Success" />
    }
</MudStack>

@if (cards.Count == 0 && !isDataLoading)
{
    <MudText Typo="Typo.h5" Class="mb-3">
        Нет карточек
    </MudText>
}
else
{
    <MudButtonGroup Color="Color.Primary" Variant="Variant.Filled" FullWidth Class="mb-5">
        <MudButton OnClick="OpenLevelOnePage"
                   Disabled="@(cards.Count < 4)">
            Уровень 1
        </MudButton>
        <MudButton OnClick="OpenLevelTwoPage"
                   Disabled="@(cards.Count == 0)">
            Уровень 2
        </MudButton>
        <MudButton OnClick="OpenLevelThreePage"
                   Disabled="@(cards.Count == 0)">
            Уровень 3
        </MudButton>
        <MudButton OnClick="OpenTestPage"
                   Disabled="@(cards.Count == 0)">
            Тест
        </MudButton>
    </MudButtonGroup>
}

@if (!isAddedMode)
{
    <MudButton OnClick="SetAddedMode"
               StartIcon="@Icons.Material.Filled.Add"
               Color="Color.Primary" Class="mb-3"
               Variant="Variant.Outlined">
        Добавить
    </MudButton>
}
else
{
    <MudPaper Class="pa-4 mb-3">
        <MudTextField Label="Слово на русском"
                      @bind-Value="newRuWord"
                      Variant="Variant.Outlined"
                      Class="mb-2" Immediate AutoFocus
                      OnKeyDown="HandleKeyDown"
                      @ref="newRuWordTextField" />

        <MudTextField Label="Слово на английском"
                      @bind-Value="newEnWord"
                      Variant="Variant.Outlined"
                      Class="mb-2" Immediate 
                      OnKeyDown="HandleKeyDown"
                      @ref="newEnWordTextField"/>
        
        @if (confirmText.IsNotEmpty())
        {
            <MudStack Row AlignItems="AlignItems.Center">
                <MudIcon Icon="@Icons.Material.Filled.Warning"
                         Color="Color.Warning" />
                
                <MudText Color="Color.Warning" Typo="Typo.body1" Class="mt-1 mb-2">
                    @confirmText
                </MudText>
            </MudStack>
        }

        <MudStack Row AlignItems="AlignItems.Center">
            <MudButton OnClick="UnsetAndClearAddedMode"
                       Color="Color.Primary" Class="mt-1"
                       Variant="Variant.Outlined">
                Отменить
            </MudButton>

            <MudSpacer/>

            <MudButton OnClick="SaveAsync"
                       Disabled="IsSaveButtonDisabled"
                       Color="Color.Primary" Class="mt-1"
                       Variant="Variant.Filled">
                @(isConfirmAction ? "Подтвердить" : "Сохранить")
            </MudButton>
        </MudStack>

        @if (isAddedLoading)
        {
            <MudProgressLinear Color="Color.Primary" Indeterminate="isAddedLoading"
                               Class="mt-2"/>
        }
    </MudPaper>
}

@foreach (var card in cards)
{
    <CardPaper Card="card"
               OnMove="MoveCardAsync"
               OnSave="LoadCardsAsync"/>
}

<CardCollectionSelectDialog @ref="cardCollectionSelectDialog" 
                            AfterSave="LoadCardsAsync" />