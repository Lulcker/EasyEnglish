@page "/"
@page "/card-collections"
@using EasyEnglish.DTO.Cards.ResponseModels

<PageTitle>EasyEnglish | Коллекции</PageTitle>

<MudAutocomplete T="SearchCardResponseModel"
                 Variant="Variant.Outlined" Dense
                 Placeholder="Поиск по словам"
                 AdornmentIcon="@Icons.Material.Filled.Search"
                 Adornment="Adornment.Start"
                 AdornmentColor="Color.Primary"
                 DebounceInterval="350"
                 SearchFunc="SearchFunc"
                 ValueChanged="OnItemSelected"
                 Clearable Class="mb-5" >
    <ItemTemplate>
        <MudLink Href="@($"/card-collection/{context.CardCollectionId}")" Underline="Underline.None">
            <MudText Typo="Typo.body1">
                <b>@context.EnWord</b>
                <MudText Typo="Typo.body1" Inline>
                    → @context.RuWord
                </MudText>
            </MudText>

            <MudText Typo="Typo.caption" Color="Color.Dark">
                Коллекция: <b>@context.CardCollectionTitle</b>
            </MudText>
        </MudLink>
    </ItemTemplate>
</MudAutocomplete>

<MudText Typo="Typo.h5" Class="mb-4">
    Коллекции карточек
</MudText>

@if (cardCollections.Count == 0 && !isDataLoading)
{
    <MudText Typo="Typo.h5" Class="mb-3">
        Нет коллекций карточек
    </MudText>
}

@if (!isAddedMode)
{
    <MudButton OnClick="SetAddedMode"
               StartIcon="@Icons.Material.Filled.Add"
               Color="Color.Primary" Class="mb-3"
               Variant="Variant.Outlined">
        Добавить
    </MudButton>
}
else
{
    <MudPaper Class="pa-4 mb-3">
        <MudTextField Label="Название коллекции"
                      @bind-Value="newCollectionTitle"
                      Variant="Variant.Outlined" Immediate
                      Class="mb-2" AutoFocus
                      OnKeyDown="HandleKeyDown" />

        <MudStack Row AlignItems="AlignItems.Center">
            <MudButton OnClick="UnsetAndClearAddedMode"
                       Color="Color.Primary" Class="mt-1"
                       Variant="Variant.Outlined">
                Отменить
            </MudButton>

            <MudSpacer/>

            <MudButton OnClick="SaveAsync"
                       Disabled="IsSaveButtonDisabled"
                       Color="Color.Primary" Class="mt-1"
                       Variant="Variant.Filled">
                Сохранить
            </MudButton>
        </MudStack>

        @if (isUpdateLoading)
        {
            <MudProgressLinear Color="Color.Primary" Indeterminate="isUpdateLoading"
                               Class="mt-2"/>
        }
    </MudPaper>
}

@foreach (var cardCollection in cardCollections)
{
    <CardCollectionPaper CardCollection="cardCollection"
                         OnSave="LoadDataAsync"/>
}